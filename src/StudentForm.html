<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Student Form - Jobsy</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
    .progress-bar {
      height: 4px;
      background-color: black;
      width: 0%;
      transition: width 0.4s ease;
    }
    .card {
      transition: transform 0.3s, box-shadow 0.3s;
      cursor: pointer;
      border: 2px solid transparent;
    }
    .card:hover {
      transform: scale(1.02);
    }
    .card.selected {
      border-color: #16a34a;
      background-color: #ecfdf5;
    }
    .form-step {
      transition: opacity 0.5s ease-in-out;
    }
    .upload-box {
      border: 2px dashed #16a34a;
      border-radius: 0.5rem;
      padding: 2rem;
      text-align: center;
      cursor: pointer;
      background-color: #f0fdf4;
      transition: background-color 0.3s ease;
    }
    .upload-box:hover {
      background-color: #dcfce7;
    }
    .step-indicator span {
      margin-right: 1rem;
      font-weight: 500;
      color: gray;
    }
    .step-indicator .active {
      font-weight: 700;
      color: black;
    }
    .chip {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    font-size: 0.875rem;
    font-weight: 500;
    border-radius: 9999px;
    margin: 0.25rem;
    color: white;
  }
  </style>
</head>
<body class="bg-white text-gray-900">
  <div class="relative z-50">
    <nav class="bg-white shadow px-4 py-3">
    <div class="max-w-7xl mx-auto flex items-center justify-between">
      <button id="menuToggle" class="mr-4 focus:outline-none">
        <svg class="w-6 h-6 text-gray-800" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
  
      <div class="flex items-center space-x-6">
        <a href="#" class="text-gray-700 font-medium">Home</a>
        <h1 class="text-2xl font-bold text-black">Jobsy</h1>
        <a href="Student.html" class="text-gray-700 font-medium">Dashboard</a>
      </div>
  
      <div class="relative">
        <button id="profileBtn" class="focus:outline-none">
          <img src="https://cdn-icons-png.freepik.com/256/1077/1077114.png?semt=ais_hybrid" alt="User" class="w-8 h-8 rounded-full" />
        </button>
        <div id="profileDropdown" class="hidden absolute right-0 mt-2 w-40 bg-white border rounded shadow-md">
          <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100">Profile</a>
          <a href="#" class="block px-4 py-2 text-sm hover:bg-gray-100">Log Out</a>
        </div>
      </div>
    </div>
  </nav>
  
  </div>
  
  <div id="sideDrawer"
    class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg z-40 transform -translate-x-full transition-transform duration-300">
    <div class="p-6">
      <h2 class="text-lg font-bold mb-4">Menu</h2>
      <ul class="space-y-2">
        <li><a href="#" class="block text-gray-800 hover:text-green-600">Home</a></li>
        <li><a href="#" class="block text-gray-800 hover:text-green-600">Dashboard</a></li>
        <li><a href="#" class="block text-gray-800 hover:text-green-600">Jobs</a></li>
        <li><a href="#" class="block text-gray-800 hover:text-green-600">Profile</a></li>
        <li><a href="#" class="block text-gray-800 hover:text-green-600">Settings</a></li>
      </ul>
    </div>
  </div>
  
  <div id="backdrop" class="hidden fixed inset-0 bg-black bg-opacity-40 z-30"></div>
  
    <div class="text-center py-6">
  
  
    <div class="text-center mb-4 step-indicator">
      <span id="stepLabel0">Personal Info</span>
      <span id="stepLabel1">Academics</span>
      <span id="stepLabel2">Job Preferences</span>
      <span id="stepLabel3">Resume</span>
      <span id="stepLabel4">Review</span>
    </div>
  
    <div class="w-full bg-gray-200 h-1 mb-6">
      <div class="progress-bar" id="progressBar"></div>
    </div>
  
    <form id="jobsyForm" class="max-w-4xl mx-auto p-6 bg-white rounded-lg shadow-md">
      <div class="form-step">
        <h2 class="text-2xl font-bold mb-4">Personal Information</h2>
        <input type="text" placeholder="Full Name" id="name" name="name" class="w-full border border-gray-300 p-3 rounded mb-4" required />
        <input type="tel" placeholder="Phone Number" id="phone" name="phone_number" class="w-full border border-gray-300 p-3 rounded mb-4" required />
        <select id="gender" name="gender" class="w-full border border-gray-300 p-3 rounded mb-4" required>
          <option value="">Select Gender</option>
          <option value="male">Male</option>
          <option value="female">Female</option>
          <option value="other">Other</option>
        </select>
      </div>
  
      <div class="form-step hidden">
        <h2 class="text-2xl font-bold mb-4">Academic Information</h2>
        <input type="number" step="0.01" id="cgpa" name="cgpa" placeholder="CGPA" class="w-full border border-gray-300 p-3 rounded mb-4" required />
        <input type="text" id="branch" name="branch" placeholder="Branch" class="w-full border border-gray-300 p-3 rounded mb-4" required />
      </div>
  
      <div class="form-step hidden">
        <h2 class="text-2xl font-bold mb-4">Job Preference</h2>
        <div class="grid grid-cols-3 gap-4 mb-6">
          <div class="card p-4 rounded shadow text-center" data-group="job" data-value="Full time">Full-Time</div>
          <div class="card p-4 rounded shadow text-center" data-group="job" data-value="Internship">Internship</div>
          <div class="card p-4 rounded shadow text-center" data-group="job" data-value="Part time">Part-Time</div>
        </div>
        <input type="hidden" name="job_type" id="jobTypeInput" />
         <input type="number" step="0.01" id="min_package" name="min_package" placeholder="Minimum Package (LPA)" class="w-full border border-gray-300 p-3 rounded mb-4" required />
        <input type="text" placeholder="Preferred Location (City)" id="preferred_location" name="preferred_location" class="w-full border border-gray-300 p-3 rounded mb-4" required />
  
        <h3 class="text-lg font-semibold mb-2">Fields of Interest</h3>
        <div class="grid grid-cols-3 gap-4 mb-4">
          <div class="card p-4 rounded shadow text-center" data-group="interest" data-value="Web Dev">Web Development</div>
          <div class="card p-4 rounded shadow text-center" data-group="interest" data-value="AI ML">AI/ML</div>
          <div class="card p-4 rounded shadow text-center" data-group="interest" data-value="Data Science">Data Science</div>
          <div class="card p-4 rounded shadow text-center" data-group="interest" data-value="Cybersecurity">Cybersecurity</div>
          <div class="card p-4 rounded shadow text-center" data-group="interest" data-value="Cloud Computing">Cloud Computing</div>
          <div class="card p-4 rounded shadow text-center" data-group="interest" data-value="Product Management">Product Management</div>
          <div class="card p-4 rounded shadow text-center" data-group="interest" data-value="Mobile Development">Mobile/iOS Development</div>
          <div class="card p-4 rounded shadow text-center" data-group="interest" data-value="Data Analysis">Data Analysis</div>
          <div class="card p-4 rounded shadow text-center" data-group="interest" data-value="Others">Others</div>
        </div>
        <input type="hidden" name="domain_of_interest" id="interestsInput" />
      </div>
  
      <div class="form-step hidden">
        <h2 class="text-xl font-semibold mb-4">Upload Resume</h2>
        <div class="upload-box">
          <input name="resume" type="file" class="hidden" id="resumeUpload" accept="application/pdf" required />
          <label for="resumeUpload" class="cursor-pointer text-green-700 font-medium">Click to upload your resume (PDF only)</label>
        </div>
      </div>
  
  
      <div class="form-step hidden">
        <h2 class="text-2xl font-bold mb-4">Review Your Details</h2>
        <div id="reviewSection" class="bg-white rounded shadow text-sm">
          <div class="grid grid-cols-2 border-b border-black divide-x divide-black">
            <div class="p-4 space-y-1">
              <h3 class="text-black font-semibold">Full Name</h3>
              <p id="r_name" class="text-gray-800 font-medium"></p>
            </div>
            <div class="p-4 space-y-1">
              <h3 class="text-black font-semibold">Phone Number</h3>
              <p id="r_phone" class="text-gray-800 font-medium"></p>
            </div>
          </div>
          <div class="grid grid-cols-2 border-b border-black divide-x divide-black">
            <div class="p-4 space-y-1">
              <h3 class="text-black font-semibold">Gender</h3>
              <p id="r_gender" class="text-gray-800 font-medium"></p>
            </div>
            <div class="p-4 space-y-1">
              <h3 class="text-black font-semibold">CGPA</h3>
              <p id="r_cgpa" class="text-gray-800 font-medium"></p>
            </div>
          </div>
          <div class="grid grid-cols-2 border-b border-black divide-x divide-black">
            <div class="p-4 space-y-1">
              <h3 class="text-black font-semibold">Branch</h3>
              <div id="r_branch" class="flex flex-wrap justify-center"></div>
            </div>
            <div class="p-4 space-y-1">
              <h3 class="text-black font-semibold">Job Type</h3>
              <p id="r_jobType" class="flex flex-wrap justify-center"></p>
            </div>
          </div>
          <div class="grid grid-cols-2 border-b border-black divide-x divide-black">
            <div class="p-4 space-y-1">
              <h3 class="text-black font-semibold">Interests</h3>
              <p id="r_interests" class="flex flex-wrap justify-center"></p>
            </div>
            <div class="p-4 space-y-1">
              <h3 class="text-black font-semibold">Resume</h3>
              <p id="r_resume" class="text-gray-800 font-medium"></p>
            </div>
          </div>
        </div>
      </div>
  
      <div class="flex justify-between pt-4">
        <button type="button" id="prevBtn" class="px-6 py-2 bg-gray-300 text-gray-800 rounded">Back</button>
        <button type="button" id="nextBtn" class="px-6 py-2 bg-black text-white rounded">Next</button>
      </div>
    </form>
  
    <div id="loadingIndicator" class="fixed top-0 left-0 w-full h-full bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
      <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-32 w-32"></div>
      <style>
        .loader {
          border-top-color: #3498db;
          -webkit-animation: spinner 1.5s linear infinite;
          animation: spinner 1.5s linear infinite;
        }
  
        @-webkit-keyframes spinner {
          0% { -webkit-transform: rotate(0deg); }
          100% { -webkit-transform: rotate(360deg); }
        }
  
        @keyframes spinner {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
      </style>
    </div>
  
    <script>
      const steps = document.querySelectorAll(".form-step");
      const progressBar = document.getElementById("progressBar");
      const nextBtn = document.getElementById("nextBtn");
      const prevBtn = document.getElementById("prevBtn");
      const form = document.getElementById("jobsyForm");
      const stepLabels = [...document.querySelectorAll(".step-indicator span")];
      const loadingIndicator = document.getElementById("loadingIndicator");
  
      let currentStep = 0;
  
      function updateStepUI() {
        steps.forEach((step, i) => step.classList.toggle("hidden", i !== currentStep));
        stepLabels.forEach((label, i) => label.classList.toggle("active", i === currentStep));
        progressBar.style.width = `${((currentStep + 1) / steps.length) * 100}%`;
        prevBtn.disabled = currentStep === 0;
        if (currentStep === steps.length - 1) {
    nextBtn.textContent = "Submit";
    nextBtn.classList.remove("bg-black", "text-white");
    nextBtn.classList.add("bg-green-600", "text-white", "hover:bg-green-700");
  } else {
    nextBtn.textContent = "Next";
    nextBtn.classList.remove("bg-green-600", "hover:bg-green-700");
    nextBtn.classList.add("bg-black", "text-white");
  }
  
      }
  
      nextBtn.addEventListener("click", async () => {
        const currentFields = steps[currentStep].querySelectorAll("input, select");
  
        for (let field of currentFields) {
          if (!field.checkValidity()) {
            field.reportValidity();
            return;
          }
        }
  
        if (currentStep === steps.length - 1) {
          loadingIndicator.classList.remove("hidden"); // Show loading indicator
          const formData = new FormData(form);
          const resumeFile = document.getElementById("resumeUpload").files[0];
          if (resumeFile) {
            formData.append("resume", resumeFile);
          }
  
          const accessToken = localStorage.getItem('jobsy_access_token');
          const tokenType = localStorage.getItem('jobsy_token_type');
  
          const headers = {
            'accept': 'application/json',
          };
  
          if (accessToken && tokenType) {
            headers['Authorization'] = `${tokenType} ${accessToken}`;
          }
  
          try {
            const response = await fetch('https://jobsy.ignorelist.com/user/students/', {
              method: 'POST',
              headers: headers,
              body: formData,
            });
  
            loadingIndicator.classList.add("hidden"); // Hide loading indicator
  
            if (response.ok) {
              const data = await response.json();
              window.location.href = '/src/Student.html';
              return;
            } else {
              const errorData = await response.json();
              alert(`Error creating student: ${errorData.message || response.statusText}`);
            }
          } catch (error) {
            loadingIndicator.classList.add("hidden"); // Hide loading indicator on error
            console.error("There was an error sending the request", error);
            alert("Failed to submit the form. Please try again later.");
          }
          return;
        }
  
        if (currentStep === steps.length - 2) {
          const data = new FormData(form);
          document.getElementById("r_name").textContent = data.get("name");
          document.getElementById("r_phone").textContent = data.get("phone_number");
          document.getElementById("r_gender").textContent = data.get("gender");
          document.getElementById("r_cgpa").textContent = data.get("cgpa");
  
          document.getElementById("r_branch").innerHTML = `<span class="px-3 py-1 rounded-full text-white bg-blue-500 mx-1 mb-1">${data.get("branch")}</span>`;
  
          const jobType = data.get("job_type");
          document.getElementById("r_jobType").innerHTML = jobType
            ? `<span class="px-3 py-1 rounded-full text-white bg-green-500 mx-1 mb-1">${jobType}</span>`
            : "";
  
          const interests = data.get("domain_of_interest").split(", ").filter(Boolean);
          const colors = ["bg-red-500", "bg-yellow-500", "bg-purple-500", "bg-pink-500", "bg-indigo-500", "bg-teal-500"];
          const chips = interests.map((item, index) =>
            `<span class="px-3 py-1 rounded-full text-white ${colors[index % colors.length]} mx-1 mb-1">${item}</span>`
          ).join("");
          document.getElementById("r_interests").innerHTML = chips;
  
          const resumeInput = document.getElementById("resumeUpload");
          const fileName = resumeInput.files[0]?.name || "No file selected";
          document.getElementById("r_resume").textContent = fileName;
        }
  
        currentStep++;
        updateStepUI();
      });
  
  
      prevBtn.addEventListener("click", () => {
        currentStep--;
        updateStepUI();
      });
  
      document.querySelectorAll(".card").forEach(card => {
        card.addEventListener("click", () => {
          const group = card.dataset.group;
          if (group === "job") {
            document.querySelectorAll(`.card[data-group="${group}"]`).forEach(c => c.classList.remove("selected"));
            card.classList.add("selected");
          } else {
            card.classList.toggle("selected");
          }
  
          const selected = [...document.querySelectorAll(`.card[data-group="${group}"].selected`)].map(c => c.dataset.value);
          document.getElementById(group === "job" ? "jobTypeInput" : "interestsInput").value = selected.join(", ");
        });
      });
  
      updateStepUI();
  
  const menuToggle = document.getElementById("menuToggle");
  const sideDrawer = document.getElementById("sideDrawer");
  const backdrop = document.getElementById("backdrop");
  
  menuToggle.addEventListener("click", () => {
    sideDrawer.classList.toggle("-translate-x-full");
    backdrop.classList.toggle("hidden");
  });
  
  backdrop.addEventListener("click", () => {
    sideDrawer.classList.add("-translate-x-full");
    backdrop.classList.add("hidden");
  });
  
  const profileBtn = document.getElementById("profileBtn");
  const profileDropdown = document.getElementById("profileDropdown");
  
  profileBtn.addEventListener("click", () => {
    profileDropdown.classList.toggle("hidden");
  });
  
  document.addEventListener("click", (e) => {
    if (!profileBtn.contains(e.target) && !profileDropdown.contains(e.target)) {
      profileDropdown.classList.add("hidden");
    }
  });
  
    </script>
  </body>